/*! jsql-developer - v1.0.0 */
!function(){function t(){this.iframe=null,this.version=e,this.win=null,this.doc=null,this.wrapper=null,this.cm=null,this.drawnTables=[],this.wrapper_selector=null,this.dependencies=["https://code.jquery.com/jquery-2.2.4.js","https://code.jquery.com/ui/1.12.0/jquery-ui.min.js","https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css","https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js","https://cdn.datatables.net/1.10.13/js/dataTables.jqueryui.min.js","https://cdn.datatables.net/1.10.13/css/dataTables.jqueryui.min.css","https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.22.0/codemirror.js","https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.22.0/mode/sql/sql.js","https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.22.0/addon/hint/show-hint.js","https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.22.0/addon/hint/sql-hint.js","https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.22.0/codemirror.css","https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.22.0/addon/hint/show-hint.css"],this.templates=[{Name:"Create",Query:"-- A Create Query Template\nCREATE TABLE IF NOT EXISTS `myTable` \n(\t`String` VARCHAR(20),\n\t`Number` INT\n)"},{Name:"Select",Query:"-- A Select Query Template\nSELECT\n\t*\nFROM\n\t`myTable`\nWHERE\n\t`Number` > 2"},{Name:"Update",Query:"-- An Update Query Template\nUPDATE `myTable`\nSET\n\t`String` = 'Big Number'\nWHERE\n\t`Number` > 2"},{Name:"Insert",Query:"-- An Insert Query Template\nINSERT INTO `myTable`\n\t(`String`, `Number`)\nVALUES\n\t('Some Number', 7)"},{Name:"Drop",Query:"-- A Drop Query Template\nDROP TABLE `myTable`"}]}if(!window.jSQL)return!1;var e="1.0.0";t.prototype.addAllTables=function(){var t;for(t in jSQL.tables)this.addTableTab(t)},t.prototype.addTableTab=function(t){var e=this.win.$;if(!(this.drawnTables.indexOf(t)>-1)){var i=e("#jSQLTableTabs").find("ul").eq(0),n="jSQLResultsTab-"+i.find("li").length;i.append('<li><a href="#'+n+'">'+t+"</a></li>"),i.after('<div id="'+n+'">Loading...</div>'),e("#"+n).data("tn",t),e("#jSQLTableTabs").tabs("refresh"),this.drawnTables.push(t)}},t.prototype.makeTableHTML=function(t,e){var i,n,o,a,r;void 0===e&&(e=!0),(i=[]).push("<table><thead><tr>");for(n in t[0])i.push("<th>"+n+"</th>");for(i.push("</tr></thead><tbody>"),o=0;o<t.length&&e;o++){i.push("<tr>");for(n in t[o])(r="string"!==(a=typeof t[o][n])&&"number"!==a?"["+a+"]":t[o][n]).length>50&&(r=r.substring(0,47)+"..."),i.push("<td>"+r+"</td>");i.push("</tr>")}return i.push("</tbody></table>"),i.join("")},t.prototype.minifyjSQLQuery=function(){var t=this.cm.getValue();this.cm.getDoc().setValue(jSQL.minify(t))},t.prototype.runjSQLQuery=function(){var t,e,i,n,o,a,r;r=this.win.$,a=this,e=this.cm.getValue();try{i=[],void 0!==(t=jSQL.query(e).execute())&&(i=t.fetchAll("assoc"),"DROP"===t.type&&(this.close(),this.open(function(){a.cm.getDoc().setValue(e)}))),n=i.length?'<br><div><small><b>Results</b></small></div><div style="overflow-x:auto; width:100%; margin:0; padding:0;">'+this.makeTableHTML(i)+"</div>":"<center><b>No results to show</b><br>Enter a query</center>",this.addAllTables(),r("#jSQLMAQueryResults").html(n),r("#jSQLMAQueryResults").find("table").DataTable({order:[],scrollX:!0})}catch(t){throw o=t.message?t.message+"":t+"",alert(o),t}},t.prototype.open=function(t,e){if(this.isOpened())return this;"function"==typeof t&&(e=t),t||(t=this.wrapper_selector),this.wrapper_selector=t,this.wrapper_selector&&(this.wrapper=document.querySelector(this.wrapper_selector));var i="overflow-x: auto; border: 0px none transparent; padding: 0px; width:100%; height: 100%;";i+=null===this.wrapper?"position:fixed; top:0; left:0; overflow-y:auto; z-index: 2147483646; background: rgba(255,255,255,0.9);":"background-color: transparent;",this.iframe=document.createElement("iframe"),this.iframe.setAttribute("style",i),this.wrapper&&(this.wrapper.innerHTML=""),(this.wrapper?this.wrapper:document.body).appendChild(this.iframe),this.win=this.iframe.contentWindow||this.iframe,this.doc=this.iframe.contentDocument||this.iframe.contentWindow.document;var n=this;this.iframe.onload=function(){n.loadDependencies(function(){jSQL.load(function(){n.drawInterface(),n.initTabs(),n.initEvents(),n.addAllTables(),n.initCodemirror(),"function"==typeof e&&e()})})},this.doc.write("<!doctype HTML><html><head><style>body{font-family:Tahoma, Geneva, sans-serif;}</style></head><body><span>Loading jSQL Devel... (<span id='progress'>0%</span>)</span></body></html>"),this.doc.close()},t.prototype.close=function(){this.iframe.parentNode.removeChild(this.iframe),this.wrapper&&(this.wrapper.innerHTML=""),this.iframe=null,this.wrapper=null,this.win=null,this.doc=null,this.cm=null,this.drawnTables=[]},t.prototype.loadDependencies=function(t){var e=this,i=this.doc.getElementById("progress");!function n(o){var a;if(i&&o>0){var r=Math.floor(o/e.dependencies.length*1e3)/10;i.innerHTML=r+"%"}if(o>=e.dependencies.length)return t();if(".CSS"===(a=e.dependencies[o]).substr(-4).toUpperCase())return e.doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeend","<link rel='stylesheet' href='"+a+"'>"),n(o+1);var s;(s=e.doc.createElement("script")).type="text/javascript",s.readyState?s.onreadystatechange=function(){"loaded"!=s.readyState&&"complete"!=s.readyState||(s.onreadystatechange=null,setTimeout(function(){n(o+1)},1e3))}:s.onload=function(){setTimeout(function(){n(o+1)},1e3)},s.src=a,e.doc.getElementsByTagName("head")[0].appendChild(s)}(0)},t.prototype.drawInterface=function(){var t,e,i,n,o=this.win.$;for(e="<select id='queryTypeSelect'><option>Choose...</option>",i=(t=this.templates).length;i--;)e+="<option value='"+t[i].Name+"'>"+t[i].Name+"</option>";e+="</select>",n=o("body").empty(),this.wrapper&&n.empty(),n.html("<h5>jSQL Version: "+jSQL.version+" | jSQLDevel Version: "+this.version+"</h5>"),n.append("<div id='jSQLTableTabs'>\t <ul>\t\t <li><a href='#jSQLNewTableTab'>New Table</a></li>\t\t <li><a href='#jSQLResultsTab'>Query</a></li>\t </ul>\t <div id='jSQLNewTableTab'>\t\t <input type='text' id='tableName' placeholder='Table Name' />\t\t <table>\t\t\t <thead>\t\t\t\t <tr>\t\t\t\t\t <th>-Name-</th>\t\t\t\t\t <th>-Type-</th>\t\t\t\t\t <th>-AI-</th>\t\t\t\t\t <th>-PK-</th>\t\t\t\t\t <th>-UN-</th>\t\t\t\t </tr>\t\t\t </thead>\t\t\t <tbody>\t\t\t\t <tr>\t\t\t\t\t <td><input type=text class=colname-jma placeholder='Column Name' /></td>\t\t\t\t\t <td>\t\t\t\t\t\t <select>\t\t\t\t\t\t\t <option>NUMERIC</option>\t\t\t\t\t\t\t <option>TINYINT</option>\t\t\t\t\t\t\t <option>SMALLINT</option>\t\t\t\t\t\t\t <option>MEDIUMINT</option>\t\t\t\t\t\t\t <option>INT</option>\t\t\t\t\t\t\t <option>BIGINT</option>\t\t\t\t\t\t </select>\t\t\t\t\t </td>\t\t\t\t\t <td><input type=checkbox class=col-ai-jma /></td>\t\t\t\t\t <td><input type=checkbox class=col-pk-jma /></td>\t\t\t\t\t <td><input type=checkbox class=col-un-jma /></td>\t\t\t\t </tr>\t\t\t </tbody>\t\t </table>\t </div>\t <div id='jSQLResultsTab'>\t\t <div>\t\t\t <div style='float:right;'><small><b>autocomplete</b>: <i>ctrl+space</i></small></div>\t\t\t <div style='float:left'><b>Template: </b>"+e+"</div>\t\t\t <div style='clear:both;'></div>\t\t </div>\t\t <textarea id='jSQLDevelQueryBox'></textarea>\t\t <div style='text-align:right;'>\t\t\t <button id='jSQLExecuteQueryButton'>Run Query</button>\t\t\t <button id='jSQLMinifyQueryButton'>Minify</button>\t\t\t <button id='jSQLResetButton'>Reset</button>\t\t\t <button id='jSQLCommitButton'>Commit</button>\t\t </div>\t\t <div id='jSQLMAQueryResults'><center><b>No results to show</b><br>Enter a query</center></div>\t </div></div>"),o("#queryTypeSelect").css({"line-height":"0.9"}),o("#jSQLExecuteQueryButton").button({icons:{primary:"ui-icon-caret-1-e"}}),o("#jSQLExecuteQueryButton").css({"line-height":"0.9"}),o("#jSQLMinifyQueryButton").button({icons:{primary:"ui-icon-minusthick"}}),o("#jSQLMinifyQueryButton").css({"line-height":"0.9"}),o("#jSQLResetButton").button({icons:{primary:"ui-icon-refresh"}}),o("#jSQLResetButton").css({"line-height":"0.9"}),o("#jSQLCommitButton").button({icons:{primary:"ui-icon-check"}}),o("#jSQLCommitButton").css({"line-height":"0.9"})},t.prototype.initTabs=function(){var t=this.win.$;t("#jSQLTableTabs").tabs({active:1,beforeActivate:function(e,i){void 0!==t(i.newPanel).data("tn")&&t(i.newPanel).html("Loading...")},activate:function(e,i){setTimeout(function(){var e,n,o,a,r;if(void 0!==(e=t(i.newPanel).data("tn"))){for(n=jSQL.select("*").from(e).execute().fetchAll("array"),o='<div style="overflow-x:auto; width:100%; margin:0; padding:0;"><table></table></div>',t(i.newPanel).html(o),a=[],r=0;r<jSQL.tables[e].columns.length;r++)a.push({title:jSQL.tables[e].columns[r]});t(i.newPanel).find("table").DataTable({data:n,columns:a})}},500)}})},t.prototype.initEvents=function(){var t=this.win.$,e=this;t("#queryTypeSelect").change(function(){var i,n;if(void 0!==(i=t(this).val())&&""!==i&&null!==i&&!1!==i){for(var o=0;o<e.templates.length;o++)e.templates[o].Name===i&&(n=e.templates[o].Query);console.log(n,i),e.cm.getDoc().setValue(n),t(this).val(t(this).find("option:first").val())}}),t("#jSQLResetButton").click(function(){confirm("Do you want to delete all tables?")&&(jSQL.reset(),e.close(),e.open())}),t("#jSQLCommitButton").click(function(){jSQL.commit(),t("#jSQLCommitButton").button("option","label","Committed!"),setTimeout(function(){t("#jSQLCommitButton").button("option","label","Commit")},2e3)}),t("#jSQLExecuteQueryButton").click(function(){e.runjSQLQuery()}),t("#jSQLMinifyQueryButton").click(function(){e.minifyjSQLQuery()})},t.prototype.initCodemirror=function(){var t=this.win.$;t("head").append("<style>.CodeMirror-hints, .CodeMirror-hint, .CodeMirror-hint-active { z-index:2147483647 !important;}.CodeMirror {border: 1px solid #eee;height: auto;}</style>");var e,i={};for(e in jSQL.tables)i[e]=jSQL.tables[e].columns;this.cm=this.win.CodeMirror.fromTextArea(t("#jSQLDevelQueryBox")[0],{mode:"text/x-mysql",indentWithTabs:!0,smartIndent:!0,matchBrackets:!0,autofocus:!0,extraKeys:{"Ctrl-Space":"autocomplete"},hint:this.win.CodeMirror.hint.sql,hintOptions:{tables:i}}),t("#jSQLTableTabs").find(".CodeMirror").css({border:"1px solid #eee",height:"auto"})},t.prototype.isOpened=function(){return null!==this.iframe},jSQL.devel=new t}();